<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Чек-листы и алгоритмы — Блокировки счетов (интерактивная версия)</title>
<meta name="description" content="Интерактивные чек-листы, дорожная карта 0–72 часа, шаблоны писем и самопроверки. Локальное сохранение, поиск, тёмная тема и экспорт полной страницы в PDF.">
<style>
  :root{
    --bg:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e2e8f0; --card:#f8fafc;
    --accent:#0ea5e9; --ok:#16a34a; --warn:#ca8a04; --bad:#dc2626;
    --chip:#eef2ff; --chip-ink:#3730a3;
  }
  :root.dark{
    --bg:#0b1220; --ink:#e5e7eb; --muted:#9aa4b2; --line:#243043; --card:#121a2c;
    --accent:#38bdf8; --ok:#22c55e; --warn:#f59e0b; --bad:#f87171;
    --chip:#1e293b; --chip-ink:#c7d2fe;
  }
  html,body{background:var(--bg); color:var(--ink); margin:0; font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif; line-height:1.6;}
  .wrap{max-width:1100px; margin:0 auto; padding:24px 14px 72px}
  h1,h2,h3{line-height:1.25; margin:0 0 12px}
  h1{font-size:clamp(28px,4vw,40px); letter-spacing:-0.02em}
  h2{font-size:clamp(20px,2.6vw,28px); margin-top:26px}
  h3{font-size:clamp(18px,2.2vw,22px); margin-top:18px}
  p{margin:8px 0}
  .muted{color:var(--muted)} .small{font-size:.92rem; color:var(--muted)}
  .hr{height:1px; background:var(--line); margin:18px 0}
  .grid{display:grid; gap:14px}
  @media(min-width:900px){ .grid.cols-2{grid-template-columns:repeat(2,1fr)} .grid.cols-3{grid-template-columns:repeat(3,1fr)} }
  .card{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin:10px 0 18px}
  .left-tools,.right-tools{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  button, .btn { background:#fff; border:1px solid var(--line); color:var(--ink); border-radius:10px; padding:8px 12px; cursor:pointer; }
  .btn-ghost{background:transparent}
  .btn-accent{background:var(--accent); border-color:transparent; color:#001928}
  .progress{height:10px; background:linear-gradient(90deg,var(--accent) var(--p,0%),transparent 0); border-radius:999px; border:1px solid var(--line); position:relative}
  .progress::after{content:attr(data-label); position:absolute; right:8px; top:-20px; font-size:12px; color:var(--muted)}
  .checklist{list-style:none; padding-left:0; margin:0}
  .checklist li{display:flex; gap:10px; align-items:flex-start; margin:10px 0; padding:8px; border-radius:12px; transition:background .2s}
  .checklist li:hover{background:rgba(14,165,233,.07)}
  .checklist input{margin-top:3px; transform:translateY(2px)}
  details[open] > summary .chev{transform:rotate(90deg)}
  details{border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:#fff}
  :root.dark details{background:#0f182a}
  summary{cursor:pointer; font-weight:700; display:flex; align-items:center; gap:8px}
  .search{display:flex; align-items:center; gap:8px; background:#fff; border:1px solid var(--line); border-radius:10px; padding:6px 10px}
  .search input{border:none; outline:none; background:transparent; color:var(--ink); width:220px}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:12px; border:1px solid var(--line); padding:1px 6px; border-radius:6px; color:var(--muted)}
  code, pre{background:#0b1220; color:#e2e8f0; border-radius:12px}
  pre{padding:12px; overflow:auto}
  .stepper{display:grid; gap:12px}
  .step-row{display:grid; grid-template-columns:160px 1fr; gap:12px}
  .step-row .left{color:var(--muted)}
  .badge{display:inline-block; font-size:12px; padding:2px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; color:var(--muted)}
  .notice{border-left:4px solid var(--accent); background:#f0f9ff; border-radius:8px; padding:10px 12px}
  .kbdline{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .compact .card{padding:12px}
  .compact .checklist li{margin:6px 0; padding:6px}
  @media print{ .toolbar{display:none} .wrap{padding:0} }
</style>
</head>
<body>
<main class="wrap" id="app">
  <header>
    <h1>Чек-листы и алгоритмы</h1>
    <p class="muted">Готовые списки и дорожные карты для быстрого применения. ✅ Прогресс сохраняется локально (LocalStorage).</p>
    <div class="kbdline small">
      <span class="badge">Финмон · учебный курс</span>
      <span class="badge">Интерактив</span>
      <span>Горячие клавиши: <span class="kbd">/</span> поиск · <span class="kbd">D</span> тёмная тема · <span class="kbd">C</span> компактно</span>
    </div>
  </header>

  <!-- Toolbar (исключаем из PDF) -->
  <div class="toolbar" data-noexport>
    <div class="left-tools">
      <label class="search" title="Поиск по чек-листам">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-3.5-3.5M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="search" type="search" placeholder="Найти пункт..." />
      </label>
      <button id="btn-clear" class="btn">Сброс прогресса</button>
      <button id="btn-export" class="btn">Экспорт PDF (вся страница)</button>
      <button id="btn-print" class="btn">Печать</button>
    </div>
    <div class="right-tools">
      <button id="btn-compact" class="btn btn-ghost" aria-pressed="false">Компактно</button>
      <button id="btn-theme" class="btn btn-ghost" aria-pressed="false">Тема</button>
    </div>
  </div>

  <!-- Прогресс -->
  <div class="card" aria-live="polite">
    <div class="grid cols-3">
      <div>
        <strong>Прогресс чек-листов</strong>
        <p class="small muted">Отмечайте пункты — мы посчитаем % выполнения.</p>
      </div>
      <div class="progress" id="progress" style="--p:0%" data-label="0%"></div>
      <div class="small muted" id="stats">0 из 0 пунктов</div>
    </div>
  </div>

  <div class="hr"></div>

  <!-- Чек-листы -->
  <div class="grid cols-2" id="lists">
    <section class="card" data-list-id="compliance">
      <h2>1) «Папка комплаенса» (минимум)</h2>
      <ul class="checklist">
        <li><label><input type="checkbox"> Профиль бизнеса (1–2 стр.: продукт, клиенты, каналы, сезонность)</label></li>
        <li><label><input type="checkbox"> Типовые договоры + примеры закрывающих (УПД/акты/накладные)</label></li>
        <li><label><input type="checkbox"> Связка «витрина/сайт/маркетплейс → чек/эквайринг/ОФД → отчёты»</label></li>
        <li><label><input type="checkbox"> Таблица проверок контрагентов (дата, источник, вывод)</label></li>
        <li><label><input type="checkbox"> Краткая записка об экономическом смысле ключевых сделок</label></li>
      </ul>
    </section>

    <section class="card" data-list-id="prepay">
      <h2>2) Самопроверка перед крупным платежом</h2>
      <ul class="checklist">
        <li><label><input type="checkbox"> Контрагент проверен (реестр, адрес, санкции, суды)</label></li>
        <li><label><input type="checkbox"> Есть «сквозная связка»: договор → счёт → отгрузка/акт → платёж</label></li>
        <li><label><input type="checkbox"> Назначение платежа конкретно и прозрачно</label></li>
        <li><label><input type="checkbox"> Доля наличных/снятий в пределах вашей политики</label></li>
        <li><label><input type="checkbox"> ОКВЭД/МСС соответствует реальной деятельности</label></li>
      </ul>
    </section>

    <section class="card" data-list-id="letter">
      <h2>3) Шаблон письма в банк</h2>
      <div class="notice small">Нажмите «Скопировать» — шаблон попадёт в буфер обмена.</div>
      <div class="kbdline" data-noexport>
        <button id="btn-copy-template" class="btn-accent">Скопировать</button>
        <span class="small muted">и вставьте в письмо/тикет банка</span>
      </div>
<pre id="template">Тема: Пояснения и документы по операциям [ID/даты]

Уважаемая служба комплаенса!
Направляем пояснения по операциям [ID] и комплект документов:
1) Договор №..., спецификация, счёт, УПД/акт.
2) Отчёты (эквайринг/маркетплейс/ОФД).
3) Пояснение по модели и сезонности.
Файлы пронумерованы, перечень — в оглавлении архива.
Контакт: [ФИО, телефон].</pre>
    </section>

    <section class="card" data-list-id="purpose">
      <h2>4) Назначения платежей — примеры</h2>
      <details open>
        <summary><span class="chev">▶</span> Хорошие формулировки</summary>
        <p><strong>Пример:</strong> «Оплата по счёту №45 от 12.09.2025 за поставку ноутбуков (спецификация от 10.09.2025), НДС 20%»</p>
      </details>
      <details>
        <summary><span class="chev">▶</span> Плохие формулировки</summary>
        <p>«За услуги», «Перевод», «Оплата» — без реквизитов/контекста.</p>
      </details>
    </section>
  </div>

  <!-- Дорожная карта -->
  <section class="card" id="roadmap">
    <h2>5) Дорожная карта «0–72 часа» при блокировке</h2>
    <div class="stepper">
      <div class="step-row">
        <div class="left"><strong>0–2 ч</strong> · Диагностика</div>
        <div><ul>
          <li>Фиксируем вид меры и инициатора (банк/ФНС/ФССП/суд).</li>
          <li>Запрашиваем основание и перечень документов.</li>
          <li>Проверяем уведомления ФНС/ФССП/суды (картотеки).</li>
        </ul></div>
      </div>
      <div class="step-row">
        <div class="left"><strong>2–12 ч</strong> · Сбор пакета</div>
        <div><ul>
          <li>Готовим «сквозную связку» по спорным операциям.</li>
          <li>Короткая пояснительная записка (модель, экономический смысл, сезонность).</li>
          <li>Проверяем корректность назначений, МСС, ОКВЭД.</li>
        </ul></div>
      </div>
      <div class="step-row">
        <div class="left"><strong>12–24 ч</strong> · Коммуникация</div>
        <div><ul>
          <li>Отправляем единый архив с оглавлением; указываем контактное лицо.</li>
          <li>Фиксируем срок рассмотрения и канал обратной связи.</li>
        </ul></div>
      </div>
      <div class="step-row">
        <div class="left"><strong>24–72 ч</strong> · Довнесение/эскалация</div>
        <div><ul>
          <li>Оперативно отвечаем на допвопросы/документы.</li>
          <li>При необходимости — апелляция/омбудсмен банка; резервный канал расчётов.</li>
          <li>Если причина — внешняя (ФНС/ФССП/суд), исполняем требования и инициируем снятие меры.</li>
        </ul></div>
      </div>
    </div>
    <div class="notice small" style="margin-top:10px"><strong>Секрет скорости:</strong> единый архив → нумерация → оглавление → краткое сопроводительное письмо.</div>
  </section>

  <div class="hr"></div>
  <footer class="small">© Финмон, 2025 · Интерактивные чек-листы. Данные сохраняются локально в вашем браузере.</footer>
</main>

<!-- jsPDF + html2canvas для PDF с кириллицей -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
/* ===== helpers ===== */
const $$ = (sel, ctx=document)=>Array.from(ctx.querySelectorAll(sel));
const $ = (sel, ctx=document)=>ctx.querySelector(sel);

/* ===== storage keys ===== */
const STORAGE_KEY='finmon_checklists_v1', THEME_KEY='finmon_theme', COMPACT_KEY='finmon_compact';
function loadState(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}')}catch{return{}} }
function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)) }
function getTheme(){ return localStorage.getItem(THEME_KEY)||'light' }
function setTheme(m){ document.documentElement.classList.toggle('dark', m==='dark'); localStorage.setItem(THEME_KEY,m) }
function getCompact(){ return localStorage.getItem(COMPACT_KEY)==='1' }
function setCompact(on){ document.body.classList.toggle('compact',!!on); localStorage.setItem(COMPACT_KEY,on?'1':'0') }

/* ===== state & wiring ===== */
const state=loadState();
function wireChecklist(section){
  const listId=section.dataset.listId||Math.random().toString(36).slice(2);
  if(!state[listId]) state[listId]={};
  $$('input[type="checkbox"]',section).forEach((box,idx)=>{
    const id=box.id|| (box.id=`${listId}_${idx}`);
    if(state[listId][id]) box.checked=true;
    box.addEventListener('change',()=>{ state[listId][id]=box.checked?1:0; saveState(state); computeProgress(); });
  });
}
function computeProgress(){
  const all=$$('input[type="checkbox"]'), checked=all.filter(b=>b.checked);
  const p=all.length?Math.round(checked.length/all.length*100):0;
  $('#progress').style.setProperty('--p',p+'%');
  $('#progress').setAttribute('data-label',p+'%');
  $('#stats').textContent=`${checked.length} из ${all.length} пунктов`;
}
function wireSearch(){
  const input=$('#search');
  input?.addEventListener('input',()=>{
    const q=input.value.trim().toLowerCase();
    $$('#lists section').forEach(sec=>{
      let any=false;
      $$('.checklist li, details, p',sec).forEach(el=>{
        const match=!q||el.textContent.toLowerCase().includes(q);
        el.style.display=match?'':'none'; if(match) any=true;
      });
      sec.style.opacity=any?'1':'0.35';
    });
  });
  window.addEventListener('keydown',(e)=>{ if(e.key==='/' && document.activeElement.tagName!=='INPUT'){ e.preventDefault(); input?.focus(); }});
}

/* ===== PDF: экспорт всей страницы (html2canvas -> jsPDF) ===== */
async function exportFullPagePDF(){
  try{
    if(!(window.jspdf && window.html2canvas)) throw new Error('libs');
    const { jsPDF } = window.jspdf;

    // Клонируем содержимое, чтобы скрыть элементы с [data-noexport]
    const src = document.querySelector('main.wrap');
    const clone = src.cloneNode(true);
    clone.querySelectorAll('[data-noexport]').forEach(el=>el.remove());

    // Временный контейнер вне экрана
    const temp = document.createElement('div');
    temp.style.position='fixed'; temp.style.left='-99999px'; temp.style.top='0';
    temp.style.width=src.offsetWidth+'px';
    temp.appendChild(clone);
    document.body.appendChild(temp);

    // Рендерим в canvas с увеличенным масштабом (качество текста/кириллица)
    const canvas = await html2canvas(clone, { scale: 2, backgroundColor: getComputedStyle(document.body).backgroundColor });
    document.body.removeChild(temp);

    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF({ unit:'pt', format:'a4', compress:true });
    const pageW = pdf.internal.pageSize.getWidth();
    const pageH = pdf.internal.pageSize.getHeight();

    // Массштаб изображения под ширину страницы
    const ratio = canvas.width / canvas.height;
    const imgW = pageW;
    const imgH = imgW / ratio;

    // Если изображение выше страницы — режем на страницы
    let y = 0;
    while(y < imgH){
      pdf.addImage(imgData, 'PNG', 0, -y, imgW, imgH);
      y += pageH;
      if(y < imgH) pdf.addPage();
    }
    pdf.save('finmon_full_page.pdf');
  }catch(e){
    alert('Не удалось сформировать PDF. Откройте печать (Ctrl/Cmd+P) и сохраните как PDF.');
    window.print();
  }
}

/* ===== copy template ===== */
function copyTemplate(){
  const txt=$('#template').innerText;
  if(navigator.clipboard?.writeText){ navigator.clipboard.writeText(txt).then(()=>notify('Шаблон скопирован.')); }
  else{
    const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy'); ta.remove(); notify('Шаблон скопирован (fallback).');
  }
}

/* ===== toast ===== */
let notifyTimer=null;
function notify(msg){
  let n=$('#notifier');
  if(!n){ n=document.createElement('div'); n.id='notifier'; Object.assign(n.style,{
    position:'fixed', bottom:'16px', left:'50%', transform:'translateX(-50%)',
    background:'var(--accent)', color:'#001928', padding:'10px 14px', borderRadius:'12px',
    boxShadow:'0 6px 20px rgba(0,0,0,.2)', zIndex:'9999'
  }); document.body.appendChild(n); }
  n.textContent=msg; n.style.opacity='1'; clearTimeout(notifyTimer);
  notifyTimer=setTimeout(()=>{ n.style.opacity='0'; },1600);
}

/* ===== UI wiring ===== */
function wireButtons(){
  $('#btn-clear').addEventListener('click',()=>{
    if(confirm('Сбросить прогресс по всем чек-листам?')){
      localStorage.removeItem(STORAGE_KEY);
      $$('input[type="checkbox"]').forEach(b=>b.checked=false);
      computeProgress(); notify('Прогресс сброшен.');
    }
  });
  $('#btn-export').addEventListener('click', exportFullPagePDF);
  $('#btn-print').addEventListener('click', ()=>window.print());
  $('#btn-copy-template')?.addEventListener('click', copyTemplate);

  const themeBtn=$('#btn-theme'); const compactBtn=$('#btn-compact');
  function toggleTheme(){ const next=document.documentElement.classList.contains('dark')?'light':'dark'; setTheme(next); themeBtn.setAttribute('aria-pressed', next==='dark'); }
  function toggleCompact(){ const on=!document.body.classList.contains('compact'); setCompact(on); compactBtn.setAttribute('aria-pressed', on); }
  themeBtn.addEventListener('click', toggleTheme);
  compactBtn.addEventListener('click', toggleCompact);

  window.addEventListener('keydown',(e)=>{ if(e.key.toLowerCase()==='d') toggleTheme(); if(e.key.toLowerCase()==='c') toggleCompact(); });
}

/* ===== query params ===== */
function applyQueryParams(){
  const q=new URLSearchParams(location.search);
  if(q.get('dark')==='1') setTheme('dark'); else setTheme(getTheme());
  if(q.get('compact')==='1') setCompact(true); else setCompact(getCompact());
}

/* ===== boot ===== */
function boot(){
  applyQueryParams();
  $$('#lists section').forEach(wireChecklist);
  wireSearch(); wireButtons(); computeProgress();
  $$('summary').forEach(s=>s.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); s.click(); } }));
}
document.addEventListener('DOMContentLoaded', boot);
</script>
</body>
</html>
