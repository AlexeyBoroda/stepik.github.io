<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Итоговый проект — «Безопасный бизнес / ПОД/ФТ» (единый кейс)</title>
  <style>
    :root {
      --bg:#0b1020; --card:#121a33; --muted:#99a3c7; --accent:#5b8cfe; --good:#3ecf8e; --bad:#ff6584; --warn:#f7b955;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:#e6ecff;font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji"}
    a{color:var(--accent)}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    h1{font-size:28px;margin:0 0 8px}
    h2{font-size:22px;margin:24px 0 12px}
    .muted{color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.row{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px}
    .card h3{margin:0 0 8px;font-size:18px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:4px 10px;border-radius:999px;background:rgba(255,255,255,.06);font-size:12px}
    textarea,input,button,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0d1430;color:#e6ecff}
    textarea{min-height:110px;resize:vertical}
    .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{cursor:pointer}
    .btn{background:#0f1a3c}
    .btn-primary{background:var(--accent);border-color:transparent;color:#08122a}
    .btn-ghost{background:transparent;border-color:rgba(255,255,255,.16)}
    .result{margin-top:10px;font-weight:600}
    .ok{color:var(--good)} .fail{color:var(--bad)} .warn{color:var(--warn)}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .progress{height:10px;background:#0d1430;border:1px solid rgba(255,255,255,.12);border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,var(--accent),#8cc9ff);width:0}
    details{background:#0f1734;border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:10px}
    code.kwd{background:#0b1436;border:1px solid rgba(255,255,255,.12);padding:2px 6px;border-radius:8px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px;text-align:left}
    .overall{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,16,32,.96),rgba(11,16,32,.8));backdrop-filter: blur(10px);border-bottom:1px solid rgba(255,255,255,.06);z-index:10}
  </style>
</head>
<body>
  <div class="overall">
    <div class="container">
      <h1>Итоговый проект (HTML+CSS+JS, единый файл)</h1>
      <div class="muted">Кейс: как построить <em>прозрачные процессы</em> и избежать блокировки счетов (115‑ФЗ, риски/контроль, коммуникация с банком).</div>
      <div class="row" style="margin:14px 0 8px">
        <div class="card">
          <div class="pill">Статус итоговой работы: <span id="overallStatus" style="margin-left:6px" class="warn">—</span></div>
          <div style="display:grid;grid-template-columns:120px 1fr;gap:10px;align-items:center;margin-top:10px">
            <div class="muted">Выполнено задач</div>
            <div><div class="progress"><div id="overallBar" class="bar"></div></div></div>
          </div>
          <div class="muted" style="margin-top:6px">Порог прохождения: <strong>≥ 80%</strong> задач верно.</div>
          <div class="buttons" style="margin-top:10px">
            <button class="btn btn-primary" data-action="grade-all">Проверить всё</button>
            <button class="btn btn-ghost" data-action="reset-all">Сбросить всё</button>
            <button class="btn" data-action="run-tests">Запустить автотесты</button>
          </div>
        </div>
        <div class="card">
          <h3>Единый кейс (введение)</h3>
          <div class="muted">Вы генеральный директор компании «Альфа», оборот 120 млн ₽/год. Банк запросил пояснения по <em>транзитным платежам</em>, <em>низкой налоговой нагрузке</em> и частым <em>снятиям наличных</em>. Нужен комплект решений: оценка рисков, политика ПОД/ФТ, чек‑листы и алгоритм общения с банком. По каждому заданию впишите ответ — будет проверка по ключевым словам/расчётам.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <h2>Задания</h2>
    <div class="row">

      <!-- T1 -->
      <section class="card" id="T1">
        <h3>1) Риски блокировки: перечислите ключевые признаки из кейса</h3>
        <div class="muted">Опишите минимум 6 признаков (ключевые слова допускают склонения).</div>
        <textarea placeholder="Например: транзитные операции, обналичивание, низкая налоговая нагрузка, несоответствие ОКВЭД..." data-input="T1"></textarea>
        <details style="margin-top:8px"><summary>Подсказки</summary>
          <div>Ищем слова: <code class="kwd">транзит</code>, <code class="kwd">обнал</code>, <code class="kwd">налоговая нагруз</code>, <code class="kwd">ОКВЭД</code>, <code class="kwd">аномал</code>, <code class="kwd">P2P</code>, <code class="kwd">криптовалют</code>, <code class="kwd">исполнительн</code>, <code class="kwd">перестрахов</code>.</div>
        </details>
        <div class="buttons">
          <button class="btn btn-primary" data-action="grade" data-task="T1">Проверить задание 1</button>
          <button class="btn" data-action="reset" data-task="T1">Сброс</button>
        </div>
        <div class="result" id="res-T1"></div>
      </section>

      <!-- T2 -->
      <section class="card" id="T2">
        <h3>2) Чек‑лист проверки контрагента</h3>
        <div class="muted">Перечислите пункты чек‑листа (мин. 6): регистраторы, сервисы, документы.</div>
        <textarea placeholder="Например: ИНН, ОГРН, ЕГРЮЛ/ЕГРИП, Прозрачный бизнес (ФНС), Rusprofile, ОКВЭД, массовый адрес, задолженность..." data-input="T2"></textarea>
        <details style="margin-top:8px"><summary>Подсказки</summary>
          <div>Ключевые слова: <code class="kwd">ИНН</code>, <code class="kwd">ОГРН</code>, <code class="kwd">ЕГРЮЛ</code>, <code class="kwd">ФНС</code>, <code class="kwd">ОКВЭД</code>, <code class="kwd">долг</code>, <code class="kwd">Rusprofile</code>, <code class="kwd">массов</code>.</div>
        </details>
        <div class="buttons">
          <button class="btn btn-primary" data-action="grade" data-task="T2">Проверить задание 2</button>
          <button class="btn" data-action="reset" data-task="T2">Сброс</button>
        </div>
        <div class="result" id="res-T2"></div>
      </section>

      <!-- T3 numeric -->
      <section class="card" id="T3">
        <h3>3) Расчёт доли налогов к обороту</h3>
        <div class="muted">Введите оборот и сумму налогов (за период). Цель — проверить, что налоговая нагрузка ≥ 0,9%.</div>
        <div class="grid-3">
          <div>
            <label class="muted">Оборот, ₽</label>
            <input type="number" min="0" step="0.01" data-num="turnover" value="120000000" />
          </div>
          <div>
            <label class="muted">Налоги, ₽</label>
            <input type="number" min="0" step="0.01" data-num="taxes" value="1500000" />
          </div>
          <div>
            <label class="muted">Результат, %</label>
            <input type="text" data-num="ratioOut" readonly />
          </div>
        </div>
        <div class="buttons">
          <button class="btn" data-action="calc" data-task="T3">Рассчитать</button>
          <button class="btn btn-primary" data-action="grade" data-task="T3">Проверить задание 3</button>
          <button class="btn" data-action="reset" data-task="T3">Сброс</button>
        </div>
        <div class="result" id="res-T3"></div>
      </section>

      <!-- T4 -->
      <section class="card" id="T4">
        <h3>4) Политика ПОД/ФТ: меры и процедуры</h3>
        <div class="muted">Опишите минимум 6 элементов: идентификация, KYC, мониторинг, заморозка, внутренний контроль...</div>
        <textarea data-input="T4" placeholder="Например: 115‑ФЗ, идентификация, изучение клиента (KYC), мониторинг операций, замораживание/блокирование, реестр рисков, обучение, ответственный сотрудник..."></textarea>
        <details style="margin-top:8px"><summary>Подсказки</summary>
          <div>Ключевые слова: <code class="kwd">115‑ФЗ</code>, <code class="kwd">идентификац</code>, <code class="kwd">KYC</code>, <code class="kwd">мониторинг</code>, <code class="kwd">замораж</code>, <code class="kwd">внутренний контроль</code>, <code class="kwd">РВК</code>, <code class="kwd">профиль риска</code>.</div>
        </details>
        <div class="buttons">
          <button class="btn btn-primary" data-action="grade" data-task="T4">Проверить задание 4</button>
          <button class="btn" data-action="reset" data-task="T4">Сброс</button>
        </div>
        <div class="result" id="res-T4"></div>
      </section>

      <!-- T5 -->
      <section class="card" id="T5">
        <h3>5) Алгоритм ответа банку на запрос</h3>
        <div class="muted">Опишите шаги и пакет документов.</div>
        <textarea data-input="T5" placeholder="Например: собрать договор, счёт, акт, пояснительную записку с экономическим смыслом, ответить в срок 5–7 дней, предупредить о нестандартной операции, при блокировке — обжалование в ЦБ..."></textarea>
        <details style="margin-top:8px"><summary>Подсказки</summary>
          <div>Ключевые слова: <code class="kwd">пояснен</code>, <code class="kwd">договор</code>, <code class="kwd">акт</code>, <code class="kwd">5–7</code>, <code class="kwd">экономическ</code>, <code class="kwd">обжал</code>.</div>
        </details>
        <div class="buttons">
          <button class="btn btn-primary" data-action="grade" data-task="T5">Проверить задание 5</button>
          <button class="btn" data-action="reset" data-task="T5">Сброс</button>
        </div>
        <div class="result" id="res-T5"></div>
      </section>

      <!-- T6 -->
      <section class="card" id="T6">
        <h3>6) Политика наличных и снятий</h3>
        <div class="muted">Опишите ограничения, документы и альтернативы (корпоративные карты, безнал).</div>
        <textarea data-input="T6" placeholder="Например: минимизировать наличные, авансовые отчёты и чеки, лимиты, бизнес‑карты, избегать cash‑out по корпоративным картам, планирование платежей..."></textarea>
        <details style="margin-top:8px"><summary>Подсказки</summary>
          <div>Ключевые слова: <code class="kwd">минимиз</code>, <code class="kwd">авансов</code>, <code class="kwd">чеки</code>, <code class="kwd">лимит</code>, <code class="kwd">бизнес‑карта</code>, <code class="kwd">cash</code>, <code class="kwd">планир</code>.</div>
        </details>
        <div class="buttons">
          <button class="btn btn-primary" data-action="grade" data-task="T6">Проверить задание 6</button>
          <button class="btn" data-action="reset" data-task="T6">Сброс</button>
        </div>
        <div class="result" id="res-T6"></div>
      </section>

      <!-- T7 -->
      <section class="card" id="T7">
        <h3>7) Ответственные и SLA коммуникаций</h3>
        <div class="muted">Опишите роли, сроки реагирования, контроль задач.</div>
        <textarea data-input="T7" placeholder="Например: назначить ответственного по ПОД/ФТ, сроки ответа банку, чек‑листы, контроль пакета документов, регламент эскалации..."></textarea>
        <details style="margin-top:8px"><summary>Подсказки</summary>
          <div>Ключевые слова: <code class="kwd">ответственн</code>, <code class="kwd">срок</code>, <code class="kwd">SLA</code>, <code class="kwd">пакет докум</code>, <code class="kwd">эскалац</code>, <code class="kwd">регламент</code>.</div>
        </details>
        <div class="buttons">
          <button class="btn btn-primary" data-action="grade" data-task="T7">Проверить задание 7</button>
          <button class="btn" data-action="reset" data-task="T7">Сброс</button>
        </div>
        <div class="result" id="res-T7"></div>
      </section>

      <!-- T8 -->
      <section class="card" id="T8">
        <h3>8) Высокорисковые P2P‑операции: признаки и меры</h3>
        <div class="muted">Опишите признаки (дропперы, крипто, нелегальные казино) и контроли.</div>
        <textarea data-input="T8" placeholder="Например: P2P, дропперы, криптовалюта, онлайн‑казино, мониторинг по картам, блокировка аномалий, требования к агентам..."></textarea>
        <details style="margin-top:8px"><summary>Подсказки</summary>
          <div>Ключевые слова: <code class="kwd">P2P</code>, <code class="kwd">дроппер</code>, <code class="kwd">крипто</code>, <code class="kwd">казино</code>, <code class="kwd">мониторинг</code>, <code class="kwd">агент</code>, <code class="kwd">блокиров</code>.</div>
        </details>
        <div class="buttons">
          <button class="btn btn-primary" data-action="grade" data-task="T8">Проверить задание 8</button>
          <button class="btn" data-action="reset" data-task="T8">Сброс</button>
        </div>
        <div class="result" id="res-T8"></div>
      </section>

    </div>

    <h2 style="margin-top:26px">Автотесты</h2>
    <div class="card">
      <div class="muted">Мини‑проверки корректности функций оценивания. Результаты ниже.</div>
      <div id="testsOut" class="result"></div>
    </div>
  </div>

  <script>
  "use strict";
  // ==== Модель заданий и ожиданий ====
  const TASKS = {
    T1: { type: "text", minHits: 6, kw: ["транзит","обнал","налоговая нагруз","оквэд","аномал","p2p","криптовалют","исполнительн","перестрахов"], sample:"транзитные операции; обналичивание; низкая налоговая нагрузка; несоответствие ОКВЭД; аномалии оборотов; P2P переводы; криптовалюта; исполнительные документы; перестрахование." },
    T2: { type: "text", minHits: 6, kw: ["инн","огрн","егрюл","фнс","оквэд","долг","rusprofile","массов"], sample:"ИНН, ОГРН, ЕГРЮЛ/ЕГРИП, ФНС Прозрачный бизнес, Rusprofile, ОКВЭД, долги, массовый адрес" },
    T3: { type: "numeric", threshold: 0.009 },
    T4: { type: "text", minHits: 6, kw: ["115","идентификац","kyc","мониторинг","замораж","внутренний контроль","рвк","риск"], sample:"115‑ФЗ; идентификация; KYC; мониторинг; замораживание; правила внутреннего контроля; риск‑профилирование; обучение" },
    T5: { type: "text", minHits: 5, kw: ["пояснен","договор","акт","5","экономическ","обжал"], sample:"Подготовить договор, акт, счета; пояснения с экономическим смыслом; ответить в срок 5–7 дней; при блокировке — обжаловать" },
    T6: { type: "text", minHits: 5, kw: ["минимиз","авансов","чек","лимит","бизнес","cash","планир"], sample:"Минимизировать наличные; авансовые отчёты и чеки; лимиты; бизнес‑карты; избегать cash‑out; планирование платежей" },
    T7: { type: "text", minHits: 5, kw: ["ответствен","срок","sla","пакет","эскалац","регламент"], sample:"Назначить ответственного; SLA по срокам; контроль пакета документов; регламент эскалации" },
    T8: { type: "text", minHits: 5, kw: ["p2p","дроппер","крипт","казин","монитор","агент","блокиров"], sample:"P2P, дропперы, крипто, онлайн‑казино, мониторинг карт, контроль агентов, блокировка аномалий" }
  };

  // ==== Утилиты ====
  const byId = id => document.getElementById(id);
  const norm = s => (s||"").toString().toLowerCase().replace(/[ё]/g,"е");

  // Подсчёт совпадений по ключевым словам (по подстроке)
  function countHits(text, keywords){
    const t = norm(text);
    let hits = 0; const matched = [];
    for(const kw of keywords){
      if(t.includes(norm(kw))){ hits++; matched.push(kw); }
    }
    return {hits, matched};
  }

  // ==== Оценивание заданий ====
  function gradeTextTask(taskId){
    const cfg = TASKS[taskId];
    const el = document.querySelector(`[data-input="${taskId}"]`);
    const resEl = byId(`res-${taskId}`);
    const {hits, matched} = countHits(el.value, cfg.kw);
    const ok = hits >= cfg.minHits;
    resEl.innerHTML = ok
      ? `✅ Найдено совпадений: <b>${hits}</b> (минимум ${cfg.minHits}). <span class="ok">Задание зачтено.</span><br><span class="muted">Совпало: ${matched.join(', ')}</span>`
      : `❌ Найдено совпадений: <b>${hits}</b> (нужно ≥ ${cfg.minHits}). <span class="fail">Доработайте ответ.</span>`;
    resEl.dataset.passed = ok ? '1' : '0';
    return ok;
  }

  function gradeNumericT3(){
    const t = Number(document.querySelector('[data-num="turnover"]').value||0);
    const x = Number(document.querySelector('[data-num="taxes"]').value||0);
    const out = document.querySelector('[data-num="ratioOut"]');
    const ratio = t>0 ? (x/t) : 0;
    out.value = (ratio*100).toFixed(3);
    const resEl = byId('res-T3');
    const ok = ratio >= TASKS.T3.threshold;
    resEl.innerHTML = ok
      ? `✅ Нагрузка ${(ratio*100).toFixed(3)}% ≥ ${(TASKS.T3.threshold*100).toFixed(2)}%. <span class="ok">Задание зачтено.</span>`
      : `❌ Нагрузка ${(ratio*100).toFixed(3)}% &lt; ${(TASKS.T3.threshold*100).toFixed(2)}%. <span class="fail">Недостаточно — предложите меры.</span>`;
    resEl.dataset.passed = ok ? '1' : '0';
    return ok;
  }

  function calcT3(){
    // вычисление без выставления результата
    const t = Number(document.querySelector('[data-num="turnover"]').value||0);
    const x = Number(document.querySelector('[data-num="taxes"]').value||0);
    const out = document.querySelector('[data-num="ratioOut"]');
    const ratio = t>0 ? (x/t) : 0; out.value = (ratio*100).toFixed(3);
  }

  function grade(taskId){
    if(!(taskId in TASKS)) return false;
    if(TASKS[taskId].type === 'text') return gradeTextTask(taskId);
    if(taskId === 'T3') return gradeNumericT3();
    return false;
  }

  // Сброс одного задания
  function resetTask(taskId){
    const cfg = TASKS[taskId];
    const resEl = byId(`res-${taskId}`);
    if(cfg.type === 'text'){
      const el = document.querySelector(`[data-input="${taskId}"]`);
      el.value = '';
    } else if(taskId === 'T3'){
      document.querySelector('[data-num="turnover"]').value = '';
      document.querySelector('[data-num="taxes"]').value = '';
      document.querySelector('[data-num="ratioOut"]').value = '';
    }
    resEl.textContent = '';
    delete resEl.dataset.passed;
  }

  function updateOverall(){
    const results = Object.keys(TASKS).map(id => byId(`res-${id}`)?.dataset?.passed === '1');
    const total = results.length;
    const passed = results.filter(Boolean).length;
    const pct = total? Math.round((passed/total)*100) : 0;
    byId('overallBar').style.width = pct+'%';
    const stEl = byId('overallStatus');
    if(pct >= 80){ stEl.textContent = `Пройден (${pct}%)`; stEl.className = 'ok'; }
    else if(pct>0){ stEl.textContent = `Промежуточно (${pct}%)`; stEl.className='warn'; }
    else { stEl.textContent = '—'; stEl.className='warn'; }
  }

  // ==== Слушатели событий (без inline-обработчиков) ====
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if(!btn) return;
    const action = btn.dataset.action;
    const task = btn.dataset.task;
    if(action === 'grade' && task){ grade(task); updateOverall(); }
    if(action === 'calc' && task==='T3'){ calcT3(); }
    if(action === 'reset' && task){ resetTask(task); updateOverall(); }
    if(action === 'grade-all'){
      for(const id of Object.keys(TASKS)) grade(id);
      updateOverall();
    }
    if(action === 'reset-all'){
      for(const id of Object.keys(TASKS)) resetTask(id);
      updateOverall();
    }
    if(action === 'run-tests') runTests();
  });

  // ==== Автотесты ====
  function expect(name, cond){
    return {name, ok: !!cond};
  }

  function runTests(){
    const rows = [];
    // T1: достаточно ключевых слов
    rows.push(expect('T1: ≥6 ключевых слов', countHits(TASKS.T1.sample, TASKS.T1.kw).hits >= TASKS.T1.minHits));
    // T2
    rows.push(expect('T2: ≥6 ключевых слов', countHits(TASKS.T2.sample, TASKS.T2.kw).hits >= TASKS.T2.minHits));
    // T3: расчёт порога 0.9%
    { const turn=1_000_000, tax=20_000; const ok = (tax/turn) >= TASKS.T3.threshold; rows.push(expect('T3: 20k/1M >= 0.9%', ok)); }
    { const turn=10_000_000, tax=10_000; const ok = (tax/turn) >= TASKS.T3.threshold; rows.push(expect('T3: 10k/10M < 0.9%', !ok)); }
    // T4–T8: smoke
    rows.push(expect('T4: ≥6 ключевых слов', countHits(TASKS.T4.sample, TASKS.T4.kw).hits >= TASKS.T4.minHits));
    rows.push(expect('T5: ≥5 ключевых слов', countHits(TASKS.T5.sample, TASKS.T5.kw).hits >= TASKS.T5.minHits));
    rows.push(expect('T6: ≥5 ключевых слов', countHits(TASKS.T6.sample, TASKS.T6.kw).hits >= TASKS.T6.minHits));
    rows.push(expect('T7: ≥5 ключевых слов', countHits(TASKS.T7.sample, TASKS.T7.kw).hits >= TASKS.T7.minHits));
    rows.push(expect('T8: ≥5 ключевых слов', countHits(TASKS.T8.sample, TASKS.T8.kw).hits >= TASKS.T8.minHits));

    const okCount = rows.filter(r=>r.ok).length; const total = rows.length;
    let html = `<div>Пройдено тестов: <b>${okCount}/${total}</b></div>`;
    html += '<table><thead><tr><th>Тест</th><th>Статус</th></tr></thead><tbody>';
    for(const r of rows){ html += `<tr><td>${r.name}</td><td>${r.ok? '✅' : '❌'}</td></tr>`; }
    html += '</tbody></table>';
    byId('testsOut').innerHTML = html;
  }

  // Инициализация
  (function init(){
    updateOverall();
  })();
  </script>
</body>
</html>
