<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Практикум для предпринимателей: Обновление данных</title>
<meta name="description" content="Практические онлайн-задания без программирования: что делать в типовых ситуациях по обновлению данных."/>
<style>
  :root{
    --bg:#fff;--fg:#0f172a;--muted:#475569;--line:#e2e8f0;--soft:#f8fafc;
    --brand:#0ea5e9;--ok:#10b981;--bad:#ef4444;--warn:#f59e0b;
    --r:16px;--shadow:0 10px 28px rgba(2,6,23,.08)
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:22px auto;padding:0 16px}
  h1{font-size:clamp(22px,3.4vw,34px);margin:0 0 8px}
  .muted{color:var(--muted)}
  .card{border:1px solid var(--line);border-radius:var(--r);background:#fff;box-shadow:var(--shadow);padding:16px;margin:14px 0}
  .grid{display:grid;gap:12px}
  @media(min-width:900px){.cols-2{grid-template-columns:1fr 1fr}.cols-3{grid-template-columns:1fr 1fr 1fr}}
  label{display:block;margin:6px 0 4px}
  input[type="text"],input[type="date"],textarea,select{
    width:100%;border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff
  }
  textarea{min-height:90px}
  .btn{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--line);border-radius:12px;background:#fff;padding:8px 12px;cursor:pointer}
  .btn.primary{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
  .btn.ok{background:#10b981;color:#fff;border-color:#10b981}
  .pill{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-size:12px;background:#f1f5f9}
  .status{padding:10px;border-radius:12px;margin-top:10px;display:none}
  .status.ok{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
  .status.bad{background:#fef2f2;color:#7f1d1d;border:1px solid #fecaca}
  .status.warn{background:#fff7ed;color:#7c2d12;border:1px solid #fed7aa}
  .qblock{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#fafcff;margin:8px 0}
  .small{font-size:13px;color:#64748b}
  details{background:#f8fafc;border:1px solid var(--line);border-radius:12px;padding:10px}
  summary{cursor:pointer}
  .progress{height:10px;border:1px solid var(--line);border-radius:999px;background:#eef2f7;overflow:hidden}
  .bar{height:100%;background:linear-gradient(90deg,#0ea5e9,#38bdf8);width:0%}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border:1px solid var(--line);padding:8px;background:#fff;vertical-align:top}
  .table th{background:#f8fafc;text-align:left}
  .row-hint{font-size:12px;color:#64748b;margin-left:6px}
  .badmark{outline:2px solid var(--bad);outline-offset:2px;border-radius:8px}
  .goodmark{outline:2px solid var(--ok);outline-offset:2px;border-radius:8px}

  /* визуальный маркер выполненного задания */
  section.card{position:relative}
  section.card.done::after{
    content:"✔ Отмечено";
    position:absolute; top:10px; right:12px;
    background:#10b981; color:#fff; padding:4px 10px;
    border-radius:999px; font-size:12px; box-shadow:0 6px 16px rgba(16,185,129,.3);
  }
  button[disabled]{opacity:.6; cursor:not-allowed}
</style>
</head>
<body>
<div class="wrap">
  <h1>Практикум: что делать в типовых ситуациях (без программирования)</h1>
  <p class="muted">Темы: смена реквизитов, ошибка в документе, нужно ли допсоглашение, готовность к оплате, план действий для своей компании, ответ банку, карта ролей.</p>

  <div class="card">
    <div class="grid cols-2">
      <div>
        <b>Ваш общий прогресс</b>
        <div class="progress" style="margin-top:6px"><div id="progressBar" class="bar"></div></div>
        <div class="small">Выполнено: <b id="progressText">0%</b> <span class="pill">сохраняется в браузере</span></div>
      </div>
      <div>
        <details><summary><b>Как работать со страницей</b></summary>
          <ul class="small">
            <li>В каждом задании отметьте шаги/варианты и нажмите «Проверить» — увидите понятный разбор.</li>
            <li>Пояснение в свободной форме — 2–3 предложения; это тренировка «что я напишу банку/коллеге».</li>
            <li>Никаких технических терминов и кода — только действия и решения.</li>
          </ul>
        </details>
      </div>
    </div>
  </div>

  <!-- Задание 1 -->
  <section class="card" id="t1">
    <h2 style="margin:0 0 6px">1) Смена банковских реквизитов — какие шаги обязательны?</h2>
    <p class="small">Ситуация: партнёр прислал письмо с новыми реквизитами. Отметьте только те шаги, которые действительно обязательны, и нажмите «Проверить».</p>
    <div class="qblock">
      <label><input type="checkbox" class="t1" data-correct="true"> Проверить письмо на бланке и приложенные документы (подтверждение банка)</label>
      <label><input type="checkbox" class="t1" data-correct="true"> Перезвонить по известному ранее телефону/почте и подтвердить изменение</label>
      <label><input type="checkbox" class="t1" data-correct="true"> Временно поставить «стоп» платежей до завершения проверки</label>
      <label><input type="checkbox" class="t1" data-correct="true"> Сделать запись в журнале: кто менял, с какой даты действует</label>
      <label><input type="checkbox" class="t1" data-correct="false"> Сразу оплатить по новым реквизитам — чтобы не задерживать поставщика</label>
      <label><input type="checkbox" class="t1" data-correct="false"> Довериться письму и не тратить время на звонки</label>
    </div>
    <div>
      <button class="btn primary" onclick="checkT1()">Проверить</button>
      <button class="btn" onclick="markDone('t1')">Отметить выполненным</button>
      <div id="t1msg" class="status warn">Подсказка: без независимой проверки и «стопа» платежей — высокий риск.</div>
    </div>
    <details style="margin-top:8px"><summary><b>Короткое объяснение</b></summary>
      <p class="small">Главная цель — исключить подмену реквизитов. Нужны: документальные основания + подтверждение по известным контактам + временный «стоп» до завершения проверки.</p>
    </details>
  </section>

  <!-- Задание 2 -->
  <section class="card" id="t2">
    <h2 style="margin:0 0 6px">2) Ошибка в документе: что делать по порядку?</h2>
    <p class="small">Ситуация: в акте/УПД неверная сумма. Поставьте каждому шагу номер от 1 до 5 (где 1 — первым).</p>
    <div class="qblock">
      <div>А) Согласовать налоговые последствия с бухгалтерией <input type="text" class="t2ord" data-step="2" placeholder="№"></div>
      <div>Б) Оформить исправление документа (УКД) или перевыставить <input type="text" class="t2ord" data-step="1" placeholder="№"></div>
      <div>В) Переподписать в ЭДО с корректными полномочиями <input type="text" class="t2ord" data-step="3" placeholder="№"></div>
      <div>Г) Обновить учёт/НДС-книги <input type="text" class="t2ord" data-step="4" placeholder="№"></div>
      <div>Д) Приложить квитанции ЭДО и закрыть инцидент <input type="text" class="t2ord" data-step="5" placeholder="№"></div>
    </div>
    <div>
      <button class="btn primary" onclick="checkT2()">Проверить</button>
      <button class="btn" onclick="markDone('t2')">Отметить выполненным</button>
      <div id="t2msg" class="status warn">Подсказка: сначала — исправление, затем согласование и подписи, после — учёт и архив.</div>
    </div>
  </section>

  <!-- Задание 3 -->
  <section class="card" id="t3">
    <h2 style="margin:0 0 6px">3) Нужен ли допсоглашение, или достаточно письма?</h2>
    <p class="small">Выберите по каждому мини-сценарию, что правильно.</p>
    <div class="qblock">
      <div>
        <b>Сценарий 1:</b> меняем цену и срок поставки. <br>
        <label><input type="radio" name="s1" value="add"> Нужен допсоглашение (корректируем условия)</label>
        <label><input type="radio" name="s1" value="letter"> Достаточно письма-уведомления</label>
      </div>
      <hr style="border:none;border-top:1px dashed var(--line)">
      <div>
        <b>Сценарий 2:</b> уточнение реквизитов получателя платежа (без изменения условий). <br>
        <label><input type="radio" name="s2" value="add"> Нужен допсоглашение</label>
        <label><input type="radio" name="s2" value="letter"> Достаточно письма на бланке + проверка</label>
      </div>
      <hr style="border:none;border-top:1px dashed var(--line)">
      <div>
        <b>Сценарий 3:</b> меняем предмет работ/спецификацию. <br>
        <label><input type="radio" name="s3" value="add"> Нужен допсоглашение</label>
        <label><input type="radio" name="s3" value="letter"> Достаточно письма</label>
      </div>
      <hr style="border:none;border-top:1px dashed var(--line)">
      <div>
        <b>Сценарий 4:</b> переносим дату отгрузки на неделю (без штрафов, по общему согласию). <br>
        <label><input type="radio" name="s4" value="add"> Нужен допсоглашение</label>
        <label><input type="radio" name="s4" value="letter"> Можно письмом, если договор это допускает</label>
      </div>
    </div>
    <div>
      <button class="btn primary" onclick="checkT3()">Проверить</button>
      <button class="btn" onclick="markDone('t3')">Отметить выполненным</button>
      <div id="t3msg" class="status warn">Подсказка: изменение условий договора (цены, сроки, предмет) — обычно через допсоглашение.</div>
    </div>
  </section>

  <!-- Задание 4 -->
  <section class="card" id="t4">
    <h2 style="margin:0 0 6px">4) Готов ли пакет к оплате?</h2>
    <p class="small">Поставьте галочки — система подскажет, можно ли запускать оплату.</p>
    <div class="qblock">
      <label><input type="checkbox" class="t4" data-weight="2"> Договор и приложения закрывают именно этот объём работ/поставки</label>
      <label><input type="checkbox" class="t4" data-weight="2"> Документ факта (акт/накладная/УПД) оформлен и подписан</label>
      <label><input type="checkbox" class="t4" data-weight="2"> Суммы и даты совпадают между счётом, актом/УПД и платёжкой</label>
      <label><input type="checkbox" class="t4" data-weight="2"> Квитанции ЭДО «доставлен/подписан» есть в деле</label>
      <label><input type="checkbox" class="t4" data-weight="2"> Для услуг есть «следы работы» (отчёты, ссылки, файлы)</label>
    </div>
    <div>
      <button class="btn primary" onclick="checkT4()">Проверить</button>
      <button class="btn" onclick="markDone('t4')">Отметить выполненным</button>
      <div id="t4msg" class="status warn">Цель — набрать минимум 8 баллов из 10 (completeness ≈ 80%).</div>
    </div>
  </section>

  <!-- Задание 5 -->
  <section class="card" id="t5">
    <h2 style="margin:0 0 6px">5) Мой план действий в компании (сгенерировать текст)</h2>
    <p class="small">Заполните коротко — и получите <b>готовый план</b>, который можно скопировать и обсудить с командой.</p>
    <div class="grid cols-2">
      <div>
        <label>Ответственные роли (кто за что)</label>
        <input id="p_roles" type="text" placeholder="Кто ставит «стоп», кто проверяет, кто подписывает...">
        <label>Сроки (когда что делаем)</label>
        <input id="p_sla" type="text" placeholder="Проверка реквизитов — 1 р.д.; исправление акта — до 3 р.д.; ...">
        <label>Где хранить доказательства</label>
        <input id="p_store" type="text" placeholder="Папка в ЭДО/CRM, реестр, ответственное лицо...">
      </div>
      <div>
        <label>Кому и о чём сообщаем</label>
        <input id="p_notify" type="text" placeholder="Казначей, бухгалтерия, продажи/закупки, банк...">
        <label>Что контролируем еженедельно</label>
        <input id="p_metrics" type="text" placeholder="Охват, время до закрывающих, дефекты...">
        <div style="margin-top:10px">
          <button class="btn primary" onclick="genPlan()">Сформировать план</button>
          <button class="btn" onclick="copyPlan()">Скопировать текст</button>
        </div>
      </div>
    </div>
    <details style="margin-top:8px"><summary><b>Подсказка</b></summary>
      <p class="small">Думайте так: «кто делает», «что именно делает», «в какой срок», «где это хранится», «как я вижу прогресс».</p>
    </details>
    <pre id="plan_out" class="qblock" style="white-space:pre-wrap"></pre>
  </section>

  <!-- Задание 6 -->
  <section class="card" id="t6">
    <h2 style="margin:0 0 6px">6) Ответ банку: соберите письмо</h2>
    <p class="small">Сформируйте вежливый и содержательный ответ. Отметьте, что приложите, и добавьте краткое пояснение «зачем была операция».</p>
    <div class="grid cols-2">
      <div>
        <label>Тип операции</label>
        <select id="op_type" onchange="T6_togglePayDocs()">
          <option value="goods">Поставка товара</option>
          <option value="mkt">Маркетинговые услуги</option>
          <option value="loan">Займ внутри группы</option>
        </select>
        <label>Сумма и период/дата</label>
        <input id="op_sum" type="text" placeholder="Напр.: 220 000 ₽ за август 2025">
        <label>Коротко: деловая цель (зачем)</label>
        <textarea id="op_goal" placeholder="2–3 предложения: для чего, какой эффект, как контролировали результат"></textarea>
      </div>
      <div>
        <label>Что приложите к письму</label>
        <label><input type="checkbox" class="t6doc" value="Договор/ТЗ"> Договор/ТЗ</label>
        <label><input type="checkbox" class="t6doc" value="Акт/накладная/УПД"> Акт/накладная/УПД</label>
        <label><input type="checkbox" class="t6doc" value="Квитанции ЭДО"> Квитанции ЭДО</label>
        <label><input type="checkbox" class="t6doc" value="Артефакты факта (отчёты/фото/ТТН)"> Артефакты факта (отчёты/фото/ТТН)</label>
        <label id="payDocsWrap" style="display:none"><input type="checkbox" class="t6doc" value="Платёжные документы (поручение/выписка)"> Платёжные документы (поручение/выписка)</label>
        <div style="margin-top:10px">
          <button class="btn primary" onclick="genLetter()">Сформировать письмо</button>
          <button class="btn" onclick="copyLetter()">Скопировать письмо</button>
          <button class="btn ok" onclick="checkT6()">Проверить</button>
        </div>
        <div id="t6msg" class="status warn">Совет: обязательно приложите «договор+факт» и «квитанции ЭДО». Для маркетинга — отчёты/скриншоты; для товара — ТТН/накладные; для займа — платёжные документы.</div>
      </div>
    </div>
    <h3 style="margin:8px 0">Черновик письма</h3>
    <pre id="letter_out" class="qblock" style="white-space:pre-wrap"></pre>
  </section>

  <!-- Задание 7 -->
  <section class="card" id="t7">
    <h2 style="margin:0 0 6px">7) Карта ролей: кто за что отвечает</h2>
    <p class="small">Для каждого пункта выберите, кто отвечает. Нажмите «Проверить» — увидите рекомендации.</p>
    <div class="qblock">
      <div>
        <label>1) Ставить «стоп» платежей
          <select id="r_stop">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
          <span class="row-hint">(временно, пока идёт проверка)</span>
        </label>
      </div>
      <div>
        <label>2) Проверять контрагента и реквизиты (KYC)
          <select id="r_kyc">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
        </label>
      </div>
      <div>
        <label>3) Оформлять допсоглашения
          <select id="r_addendum">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
        </label>
      </div>
      <div>
        <label>4) Оформлять исправления к первичке (УКД)
          <select id="r_ukd">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
        </label>
      </div>
      <div>
        <label>5) Проверять первичку и НДС
          <select id="r_primary">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
        </label>
      </div>
      <div>
        <label>6) Запускать платёж при полном пакете
          <select id="r_pay">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
        </label>
      </div>
      <div>
        <label>7) Вести реестр/архив документов и квитанций
          <select id="r_archive">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
        </label>
      </div>
      <div>
        <label>8) Формулировать деловую цель и собирать «следы работы»
          <select id="r_purpose">
            <option value="">— выберите —</option>
            <option>Инициатор</option><option>Юрист</option><option>KYC/Безопасность</option>
            <option>Бухгалтерия/Налоги</option><option>Казначей</option><option>Архив/ЭДО</option>
          </select>
        </label>
      </div>
    </div>
    <div>
      <button class="btn primary" onclick="checkT7()">Проверить</button>
      <button class="btn" onclick="markDone('t7')">Отметить выполненным</button>
      <div id="t7msg" class="status warn">Подсказка: «стоп» и запуск платежей — у казначея; договоры — у юриста; первичка и УКД — у бухгалтерии; архив — у документооборота; KYC — у безопасности; деловая цель — у инициатора.</div>
    </div>
  </section>

  <footer class="small muted">Данные сохраняются в вашем браузере. Можно встраивать на платформу через iFrame.</footer>
</div>

<script>
/* ===== Прогресс (устойчиво к блокировке хранилища) ===== */
const KEY='pb-upd-practice-v1';
let state={};
try{ state=JSON.parse(localStorage.getItem(KEY)||'{}') }catch(e){ state={} }

const tasks=['t1','t2','t3','t4','t5','t6','t7'];

function persist(){
  try{
    localStorage.setItem(KEY, JSON.stringify(state));
    return true; // сохранено
  }catch(e){
    return false; // хранилище недоступно
  }
}

function markDone(id){
  // 1) логика состояния
  state[id]=true;
  const saved = persist();

  // 2) визуальная отметка на карточке
  const sec = document.getElementById(id);
  if(sec){ sec.classList.add('done'); }

  // 3) меняем саму кнопку («Отмечено», отключаем)
  if(sec){
    const btn = Array.from(sec.querySelectorAll('button')).find(b=>{
      const h = (b.getAttribute('onclick')||''); return h.includes("markDone(");
    });
    if(btn){ btn.disabled=true; btn.classList.add('ok'); btn.textContent='Отмечено'; }
  }

  // 4) показываем локальный зелёный статус в блоке задания
  if(sec){
    let note = sec.querySelector('.js-done-note');
    if(!note){
      note = document.createElement('div');
      note.className='status ok js-done-note';
      sec.appendChild(note);
    }
    note.style.display='block';
    note.innerHTML = saved
      ? '✅ Задание отмечено выполненным. Прогресс сохранён.'
      : '✅ Задание отмечено. ⚠️ Прогресс между визитами может не сохраниться (браузер блокирует хранилище).';
  }

  // 5) обновляем общий прогресс сверху
  updateProgress();
}

function updateProgress(){
  const done = tasks.filter(t=>state[t]).length;
  const pct = Math.round(done/tasks.length*100);
  const bar = document.getElementById('progressBar');
  const txt = document.getElementById('progressText');
  if(bar) bar.style.width = pct+'%';
  if(txt) txt.textContent = pct+'%';
  // визуально подсветим все уже выполненные
  tasks.forEach(id=>{
    const sec=document.getElementById(id);
    if(!sec) return;
    if(state[id]){
      sec.classList.add('done');
      const btn = Array.from(sec.querySelectorAll('button')).find(b=>{
        const h=(b.getAttribute('onclick')||''); return h.includes("markDone(");
      });
      if(btn){ btn.disabled=true; btn.classList.add('ok'); btn.textContent='Отмечено'; }
    }
  });
}
// вызвать при загрузке
updateProgress();

/* ===== Хелперы ===== */
function $(id){ return document.getElementById(id); }

/* ===== Задание 1 ===== */
function checkT1(){
  const checks=document.querySelectorAll('.t1');
  let ok=true;
  checks.forEach(c=>{
    const should = c.dataset.correct==='true';
    if(should && !c.checked) ok=false;
    if(!should && c.checked) ok=false;
  });
  const m=document.getElementById('t1msg'); m.style.display='block';
  if(ok){
    m.className='status ok';
    m.innerHTML='✅ Верно. Обязательные шаги: документальные основания, независимое подтверждение, временный «стоп» и запись в журнале. После этого — вносим изменения и снимаем «стоп».';
    markDone('t1');
  } else {
    m.className='status bad';
    m.innerHTML='❌ Проверьте себя: платить «сразу по письму» и «без звонка» — ошибки. Отметьте только шаги с проверкой и «стопом».';
  }
}

/* ===== Задание 2 ===== */
function checkT2(){
  const inputs=document.querySelectorAll('.t2ord');
  const want=['1','2','3','4','5'];
  const got=[...inputs].map(i=>i.value.trim());
  const m=document.getElementById('t2msg'); m.style.display='block';
  if(JSON.stringify(got)===JSON.stringify(want)){
    m.className='status ok';
    m.innerHTML='✅ Отлично: сначала исправляем документ, затем согласование и подписи, после — учёт и архив.';
    markDone('t2');
  } else {
    m.className='status bad';
    m.innerHTML='❌ Есть перестановки. Подсказка: 1) оформить исправление; 2) согласовать налоги; 3) переподписать; 4) обновить учёт; 5) приложить квитанции и закрыть инцидент.';
  }
}

/* ===== Задание 3 ===== */
function checkT3(){
  const m=document.getElementById('t3msg'); m.style.display='block';
  const s1=document.querySelector('input[name="s1"]:checked')?.value;
  const s2=document.querySelector('input[name="s2"]:checked')?.value;
  const s3=document.querySelector('input[name="s3"]:checked')?.value;
  const s4=document.querySelector('input[name="s4"]:checked')?.value;
  const ok = (s1==='add')&&(s2==='letter')&&(s3==='add')&&(s4 && (s4==='letter'));
  if(ok){
    m.className='status ok';
    m.innerHTML='✅ Верно: изменение цены/сроков и предмета — через допсоглашение; уточнение реквизитов — письмом с проверкой; перенос даты можно письмом, если договор это допускает.';
    markDone('t3');
  } else {
    m.className='status bad';
    m.innerHTML='❌ Проверьте: всё, что меняет условия договора (цены, сроки, предмет) — допсоглашение. Реквизиты/технические детали — письмо + проверка.';
  }
}

/* ===== Задание 4 ===== */
function checkT4(){
  const checks=document.querySelectorAll('.t4');
  let score=0; checks.forEach(c=>{ if(c.checked) score += Number(c.dataset.weight||0); });
  const m=document.getElementById('t4msg'); m.style.display='block';
  if(score>=8){
    m.className='status ok';
    m.innerHTML='✅ Пакет готов к оплате (комплект ≥ 80%). Можно запускать платёж.';
    markDone('t4');
  } else {
    m.className='status bad';
    m.innerHTML='❌ Недостаточно доказательств. Проверьте договор/акт, сверку сумм и дат, квитанции ЭДО и «следы работы». Цель — набрать минимум 8 из 10.';
  }
}

/* ===== Задание 5 ===== */
function genPlan(){
  const roles=document.getElementById('p_roles').value.trim()||'—';
  const sla=document.getElementById('p_sla').value.trim()||'—';
  const store=document.getElementById('p_store').value.trim()||'—';
  const notify=document.getElementById('p_notify').value.trim()||'—';
  const metrics=document.getElementById('p_metrics').value.trim()||'—';
  const txt =
`План действий (черновик):

1) Роли и ответственность: ${roles}.
2) Сроки (как правило): ${sla}.
3) Где храним доказательства: ${store}.
4) Кого и как уведомляем: ${notify}.
5) Еженедельный контроль: ${metrics}.
6) Перед оплатой — чек «готовности»: договор/акт на этот объём, совпадение сумм и дат, квитанции ЭДО, «следы работы».
7) При смене реквизитов — письмо на бланке + независимый звонок + «стоп» до проверки.
8) Ошибку в документе исправляем: исправление/перевыставление → подписи → учёт → архив.
9) Изменение условий договора — только через допсоглашение с датой «вступает с…».
10) Итог: всё фиксируем в журнале изменений (кто, что, когда, с какой даты).`;
  document.getElementById('plan_out').textContent = txt;
  markDone('t5');
}
function copyPlan(){
  const text=document.getElementById('plan_out').textContent||'';
  if(!text.trim()){ alert('Сначала нажмите «Сформировать план».'); return; }
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=>alert('Скопировано в буфер обмена.')).catch(()=>alert('Не удалось скопировать. Выделите текст и нажмите Ctrl+C.'));
  } else {
    alert('Выделите текст мышкой и нажмите Ctrl+C.');
  }
}

/* ===== Задание 6: Письмо банку ===== */
function T6_togglePayDocs(){
  const v=document.getElementById('op_type').value;
  document.getElementById('payDocsWrap').style.display = (v==='loan') ? 'block' : 'none';
}
T6_togglePayDocs();

function genLetter(){
  const type=document.getElementById('op_type').value;
  const sum=document.getElementById('op_sum').value.trim();
  const goal=document.getElementById('op_goal').value.trim();
  const docs=[...document.querySelectorAll('.t6doc')].filter(x=>x.checked).map(x=>x.value);
  const typeName = type==='goods'?'поставка товара':(type==='mkt'?'маркетинговые услуги':'займ внутри группы');

  const lines=[];
  lines.push('Тема: Пояснение по операции — '+typeName+(sum?(', '+sum):''));
  lines.push('');
  lines.push('Уважаемые коллеги,');
  lines.push('Сообщаем пояснения по операции: '+typeName+(sum?(' ('+sum+')'):'')+'.');
  if(goal){ lines.push('Деловая цель: '+goal); }
  lines.push('К письму прилагаем:');
  docs.forEach(d=>lines.push('— '+d));
  lines.push('Просим учесть, что оплата/учёт производится при полном и непротиворечивом пакете документов, квитанции ЭДО прилагаются.');
  lines.push('Готовы предоставить дополнительные пояснения при необходимости.');
  lines.push('');
  lines.push('С уважением,');
  lines.push('__________________________');

  document.getElementById('letter_out').textContent = lines.join('\n');
}

function copyLetter(){
  const text=document.getElementById('letter_out').textContent||'';
  if(!text.trim()){ alert('Сначала нажмите «Сформировать письмо».'); return; }
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=>alert('Скопировано в буфер обмена.')).catch(()=>alert('Не удалось скопировать. Выделите текст и нажмите Ctrl+C.'));
  } else {
    alert('Выделите текст мышкой и нажмите Ctrl+C.');
  }
}

function checkT6(){
  const msg=document.getElementById('t6msg'); msg.style.display='block';
  const type=document.getElementById('op_type').value;
  const goal=document.getElementById('op_goal').value.trim();
  const docs=[...document.querySelectorAll('.t6doc')];
  const has = name => docs.find(x=>x.checked && x.value.indexOf(name)>=0);

  let ok=true, tips=[];
  if(goal.length<20){ ok=false; tips.push('Добавьте 2–3 предложения о деловой цели.'); }

  // базовые документы
  if(!has('Договор/ТЗ')){ ok=false; tips.push('Добавьте «Договор/ТЗ».'); }
  if(!has('Акт/накладная/УПД')){ ok=false; tips.push('Добавьте «Акт/накладная/УПД».'); }
  if(!has('Квитанции ЭДО')){ ok=false; tips.push('Добавьте «Квитанции ЭДО».'); }

  // по типам
  if(type==='mkt' && !has('Артефакты факта')){ ok=false; tips.push('Для услуг приложите «Артефакты факта (отчёты/скрины)».'); }
  if(type==='goods' && !has('Артефакты факта')){ ok=false; tips.push('Для товара приложите «ТТН/фото/накладные» (они в «Артефакты факта»).'); }
  if(type==='loan'){
    const payDocs=document.querySelector('#payDocsWrap input');
    if(!(payDocs && payDocs.checked)){ ok=false; tips.push('Для займа добавьте «Платёжные документы».'); }
  }

  if(ok){
    msg.className='status ok';
    msg.innerHTML='✅ Отлично: письмо содержит цель и нужный комплект вложений. Можно отправлять.';
    markDone('t6');
  } else {
    msg.className='status bad';
    msg.innerHTML='❌ Требуются правки:<br>• '+tips.join('<br>• ');
  }
}

/* ===== Задание 7: Карта ролей ===== */
function checkT7(){
  // эталон
  const correct = {
    r_stop:'Казначей',
    r_kyc:'KYC/Безопасность',
    r_addendum:'Юрист',
    r_ukd:'Бухгалтерия/Налоги',
    r_primary:'Бухгалтерия/Налоги',
    r_pay:'Казначей',
    r_archive:'Архив/ЭДО',
    r_purpose:'Инициатор'
  };
  const ids=Object.keys(correct);
  let wrong=[], unset=[];
  ids.forEach(id=>{
    const sel=document.getElementById(id);
    sel.classList.remove('badmark','goodmark');
    const val=sel.value;
    if(!val){ unset.push(idToText(id)); return; }
    if(val!==correct[id]) wrong.push(idToText(id));
    else sel.classList.add('goodmark');
  });
  const m=document.getElementById('t7msg'); m.style.display='block';

  if(unset.length){
    m.className='status bad';
    m.innerHTML='❌ Заполните все пункты: '+unset.join('; ');
    return;
  }
  if(wrong.length){
    m.className='status bad';
    m.innerHTML='❌ Есть несоответствия: '+wrong.join('; ')+'<br><span class="small">Подсказка: «стоп/запуск платежей» — казначей; «допники» — юрист; «УКД/НДС» — бухгалтерия; «KYC» — безопасность; «архив» — ЭДО; «деловая цель» — инициатор.</span>';
    // подсветим неверные
    ids.forEach(id=>{
      const sel=document.getElementById(id);
      if(sel.value && sel.value!==correct[id]) sel.classList.add('badmark');
    });
  } else {
    m.className='status ok';
    m.innerHTML='✅ Карта ролей составлена правильно. Можно использовать это распределение в компании.';
    markDone('t7');
  }
}
function idToText(id){
  const map={
    r_stop:'«Стоп» платежей',
    r_kyc:'Проверка контрагента (KYC)',
    r_addendum:'Допсоглашения',
    r_ukd:'Исправления к первичке (УКД)',
    r_primary:'Проверка первички и НДС',
    r_pay:'Запуск платежа',
    r_archive:'Реестр/архив',
    r_purpose:'Деловая цель и «следы работы»'
  }; return map[id]||id;
}
</script>
</body>
</html>
